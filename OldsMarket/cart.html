<!DOCTYPE html>
<html lang="en">

<head>

    <!--meta tags-->
    <meta charset="UTF-8">
    <meta name="description" content="Services Listing HTML5 CSS3 template">
    <meta name="keywords" content="HTML,CSS,XML,JavaScript, services, listing">
    <meta name="author" content="Ui-DesignLab">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!--end meta tags-->

    <title>购物车</title>
    <!--stylesheets-->
    <link rel="stylesheet" href="vendor/css/bootstrap.min.css">
    <link rel="stylesheet" href="vendor/css/animate.min.css">
    <link rel="stylesheet" href="vendor/font-awesome-4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="vendor/perfect-scrollbar/css/perfect-scrollbar.min.css">
    <link rel="stylesheet" href="css/app.css">

    <!-- Element ui -->
    <link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css">

    <!--end stylesheets-->

    <!--google fonts-->
    <link
        href="https://fonts.googleapis.com/css?family=Cairo%7CNosifer%7CPoppins%7CQuicksand:700%7CRaleway%7CTangerine%7CHind+Vadodara"
        rel="stylesheet">
    <!--end google fonts-->
</head>

<body>


    <div id="app">
        <!--导航栏-->
        <nav class="site-top-nav">
            <div class="logo">
                <a href="index.html">
                    <img src="img/logo.png" alt="">
                    <strong>升龙二物品交易平台</strong>
                </a>
            </div>
            <ul class="site-menu">
                <li>
                    <a href="index.html">首页 <i class="fa fa-angle-down"></i></a>
                </li>
                <li>
                    <a href="pricing.html">其他页面<i class="fa fa-angle-down"></i></a>
                    <ul class="nav-dropdown">
                        <li><a href="cart.html">购物车</a></li>
                        <li><a href="payment-info.html">支付信息</a></li>
                        <li><a href="dash-items.html">我的订单</a></li>
                    </ul>
                </li>
                <li><a href="login-register.html" class="ui-btn ui-btn-info" id="username">Get Started</a></li>
            </ul>
            <i class="nav-toggle fa fa-bars"></i>
        </nav>
        <!--导航栏结束-->

        <!--cart section-->
        <div class="cart-wrapper">
            <div class="cart">
                <div class="items-count">你有 <strong class="ui-text-success" id="count">{{count}}</strong> 个订单</div>
                <table class="table table-responsive cart-table">
                    <thead>
                        <tr>
                            <th></th>
                            <th><span class="ui-text-success">商品名</span></th>
                            <th><span class="ui-text-success">单价</span>/<span class="ui-text-success">数量</span></th>
                            <th><span class="ui-text-success">总价</span></th>
                        </tr>
                    </thead>
                    <tbody id="aaa">
                        <tr v-for="(item,key) in list" v-bind:key="key">
                            <td>
                                <div>
                                    <i class="del" @click="delect(item._id)">x</i>
                                    <div class="item-img">
                                        <img v-bind:src=" 'http://localhost:3009'+item.product.coverImg">
                                    </div>
                                </div>
                            </td>
                            <td> 
                                <strong>{{item.product.name}}</strong>
                            </td>
                            <td>
                                <div class="price-control">
                                    <strong class="unit-price">￥ <span
                                            data-price="799">{{item.product.price}}</span></strong>
                                    <span>x</span>
                                    <input type="button" value="-" @click="recream(item.product._id)" />
                                    <input type="text" :value="item.quantity" />
                                    <input type="button" value="+" @click="incream(item.product._id)" />
                                    <!-- </div> -->
                                </div>
                            </td>
                            <td>
                                <strong>￥<span class="total">{{item.product.price * item.quantity}}</span></strong>
                            </td>
                        </tr>
                    </tbody>
                </table>
                <div class="cart-bottom">
                    <h3><span>合计:</span>￥<strong class="sub-total ui-text-success" id="price"></strong></h3>
                    <p class="cart-bt-act">
                        <a href="index.html"><i class="fa fa-angle-left"></i> 继续购物</a>
                        <a href="payment-info.html" class="continue" onclick="add()">去支付 <i class="fa fa-angle-right"></i></a>
                    </p>
                </div>
            </div>
        </div>
        <!--end cart section-->

        <footer class="footer">
            <div class="footer-item">
                <strong>联系我们</strong>
                <a href="#"><i class="fa fa-angle-right"></i> 刊登广告</a>
                <a href="#"><i class="fa fa-angle-right"></i> 社区论坛</a>
                <a href="#"><i class="fa fa-angle-right"></i> 联盟计划</a>
            </div>
            <div class="footer-item">
                <strong>帮助中心</strong>
                <a href="#"><i class="fa fa-angle-right"></i> 账户管理</a>
                <a href="#"><i class="fa fa-angle-right"></i> 购物指南</a>
                <a href="#"><i class="fa fa-angle-right"></i> 订单操作</a>
            </div>
            <div class="footer-item">
                <strong>关注我们</strong>
                <a href="#"><i class="fa fa-angle-right"></i> 新浪微博</a>
                <a href="#"><i class="fa fa-angle-right"></i> 官方微信</a>
                <a href="#"><i class="fa fa-angle-right"></i> 联系我们</a>
            </div>
            <div class="footer-item">
                <strong>服务支持</strong>
                <a href="#"><i class="fa fa-angle-right"></i> 售后政策</a>
                <a href="#"><i class="fa fa-angle-right"></i> 自助服务</a>
                <a href="#"><i class="fa fa-angle-right"></i> 相关下载</a>
            </div>
        </footer>
        <div class="bottom-strip">
            <div class="cards-accepted">
                <img src="img/card-logos.png" alt="">
            </div>
            <div class="copyright"><i class="fa fa-copyright"></i> <span>升龙. 想你所想</span></div>
            <div class="country"><span>中国</span><img src="img/flag.jpg" alt=""></div>
        </div>
        <!--end footer section-->

        <!--page loader-->
        <div class="page-loader">
            <div class="loader"><img src="img/logo.png" alt=""></div>
        </div>
    </div>
    <!--end page loader-->

    <!--scripts-->
    <script src="vendor/js/jquery-3.2.1.min.js"></script>
    <script src="vendor/js/popper.js"></script>
    <script src="vendor/js/bootstrap.min.js"></script>
    <script src="vendor/js/alertify.js"></script>
    <script src="vendor/js/jquery.knob.min.js"></script>
    <script src="vendor/js/summernote-bs4.min.js"></script>
    <script src="vendor/js/dropzone.js"></script>
    <script src="vendor/OwlCarousel2-2.2.1/owl.carousel.min.js"></script>
    <script src="vendor/perfect-scrollbar/js/perfect-scrollbar.jquery.min.js"></script>
    <script src="vendor/js/typed.js"></script>
    <script src="js/app.js"></script>
    <script src="js/axios.min.js"></script>

    <!-- vue 和Element ui -->
    <script src="js/vue.min.js"></script>
    <script src="https://unpkg.com/element-ui/lib/index.js"></script>

    <script>
        if(sessionStorage.getItem("token")){
        $("#username").html(sessionStorage.getItem("nickName"))
    }
        new Vue({
            el: '#app',
            data: function () {
                return {
                    detailId: location.search.slice(1),
                    token: sessionStorage.getItem("token"),
                    aaa: document.getElementById("aaa"),
                    count: 0,//购物车类别数量
                    price: document.getElementById("price"),
                    del: document.getElementsByClassName("del"),
                    list: [],//列表
                }
            },
            methods: {
                //删除
                delect(id) {
                    axios.delete("http://localhost:3009/api/v1/shop_carts/" + id,
                        { headers: { authorization: "Bearer " + this.token } }).then((res) => {
                            console.log(res)
                        }).catch();
                        this.getCart()
                },
                incream(product) {
                    let quantity = 0;
                    quantity++
                    axios.post("http://localhost:3009/api/v1/shop_carts", {
                        product: product,
                        quantity: quantity
                    }, { headers: { authorization: "Bearer " + this.token } }).then((res) => {
                        console.log(res)
                    }).catch();
                    this.getCart()
                },
                recream(product) {
                    let quantity = 0;
                    quantity--;
                    axios.post("http://localhost:3009/api/v1/shop_carts", {
                        product: product,
                        quantity: quantity
                    }, { headers: { authorization: "Bearer " + this.token } }).then((res) => {
                        console.log(res)
                    }).catch();
                    this.getCart()
                },
                //计数器
                handleChange(num, id) {
                    axios.post("http://localhost:3009/api/v1/shop_carts", {
                        product: id,
                        quantity: num
                    }, { headers: { authorization: "Bearer " + this.token } }).then((res) => {
                        console.log(res)
                    }).catch();
                    this.getCart()
                },
                getCart(){
                    axios.get("http://localhost:3009/api/v1/shop_carts",
                    { headers: { authorization: "Bearer " + this.token } }).then((res) => {
                        this.list = res.data
                        this.count = this.list.length
                        console.log(this.list)
                    })
                },
                add(){
                    axios.post("http://localhost:3009/api/v1/orders", {
                    receiver:"王",
                    regions:"河南省郑州市新郑市龙湖镇",
                    address:"文昌路一号",
                    orderDetails:this.list,
            price:60
        }, { headers: { authorization: "Bearer " + token } }).then((res) => {
            console.log(res)
            if(res.status==200){
                alert("加入购物车成功")
            }
        }).catch();
                }
            },
            mounted() {
                this.getCart()
            }
        })
        let price = document.getElementById("price")
        let c = 0
        let token = sessionStorage.getItem("token");
        axios.get("http://localhost:3009/api/v1/shop_carts",
        { headers: { authorization: "Bearer " + token } }).then((res) => {
            let arrs = res.data
            for(let i=0;i<=arrs.length;i++){
                let a = arrs[i].product.price * arrs[i].quantity
                let b = parseInt(a)
                c+=b
                price.innerHTML = c
            }
    });

    </script>
    <!--end scripts-->

</body>

</html>